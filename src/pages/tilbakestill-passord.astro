---
// src/pages/tilbakestill-passord.astro
import Layout from "../layouts/Layout.astro";
export const prerender = false;

const url = new URL(Astro.request.url);
const error = url.searchParams.get("error");
const message = url.searchParams.get("message");
---

<Layout title="Tilbakestill passord">
  <div class="max-w-md mx-auto mt-12 md:mt-20">
    <main class="bg-white p-8 md:p-10 rounded-3xl shadow-xl border border-slate-100">
      <div class="mb-8">
        <h1 class="text-3xl font-black text-slate-900 tracking-tight mb-2">
          Nytt passord
        </h1>
        <p class="text-slate-500 italic text-sm">
          Skriv inn ditt nye passord under.
        </p>
      </div>

      {error && (
        <div class="bg-red-50 border-2 border-red-200 p-4 rounded-2xl mb-6">
          <div class="flex items-center gap-2">
            <span class="text-red-600 text-xl">⚠️</span>
            <p class="text-red-800 font-bold text-sm">{decodeURIComponent(error)}</p>
          </div>
        </div>
      )}

      {message && (
        <div class="bg-emerald-50 border-2 border-emerald-200 p-4 rounded-2xl mb-6">
          <div class="flex items-center gap-2">
            <span class="text-emerald-600 text-xl">✓</span>
            <p class="text-emerald-800 font-bold text-sm">{decodeURIComponent(message)}</p>
          </div>
        </div>
      )}

      <form action="/api/auth/update-password" method="POST" class="space-y-4">
        <div class="space-y-3">
          <div>
            <label class="block text-[10px] font-black uppercase text-slate-400 mb-1">Nytt passord</label>
            <input 
              type="password" 
              name="password" 
              required 
              minlength="6"
              class="w-full border-2 border-slate-100 rounded-xl px-4 py-3"
              placeholder="Minst 6 tegn"
            />
          </div>
          <div>
            <label class="block text-[10px] font-black uppercase text-slate-400 mb-1">Bekreft passord</label>
            <input 
              type="password" 
              name="passwordConfirm" 
              required 
              minlength="6"
              class="w-full border-2 border-slate-100 rounded-xl px-4 py-3"
              placeholder="Skriv inn same passord igjen"
            />
          </div>
        </div>
        
        <button 
          type="submit" 
          class="w-full bg-indigo-600 text-white font-black py-4 rounded-2xl hover:bg-indigo-500 hover:shadow-lg hover:shadow-indigo-200 transition-all active:scale-[0.98]"
        >
          OPPDATER PASSORD
        </button>
      </form>

      <p class="text-[10px] text-center text-slate-400 uppercase font-bold tracking-tighter mt-6">
        Sikker oppdatering via Supabase Auth
      </p>
    </main>

    <div class="max-w-md mx-auto mt-8 p-4 bg-emerald-50 rounded-2xl border border-emerald-100">
      <p class="text-xs text-slate-600 text-center">
        <strong class="text-slate-900">Sikkerheit:</strong> Etter at du har oppdatert passordet, blir du logga inn automatisk.
      </p>
    </div>
  </div>
</Layout>
