---
// src/components/StockRefillCard.astro
const { id, type, shape, currentCount, minThreshold, dimmable, rechargeable } = Astro.props;

// Logikk for farger og status
const isLow = currentCount <= minThreshold;
const isCritical = currentCount === 0;

// Finn rett farge-tema basert på status
const statusStyles = isCritical 
  ? 'border-red-500 bg-red-50 shadow-red-100' 
  : isLow 
    ? 'border-amber-400 bg-amber-50 shadow-amber-100' 
    : 'border-slate-100 bg-white hover:border-slate-200';
---

<div class={`p-5 rounded-[2rem] border-2 transition-all shadow-sm ${statusStyles}`}>
  <div class="flex justify-between items-start mb-4">
    <div class="overflow-hidden flex-1">
      <div class="flex items-center gap-2 mb-1.5">
        <h3 class="font-black text-slate-900 text-lg leading-none tracking-tighter truncate">{type}</h3>
        {dimmable && (
          <span class="text-[8px] font-black bg-amber-200 text-amber-900 px-1.5 py-0.5 rounded-lg uppercase tracking-wider">Dim</span>
        )}
        {rechargeable && (
          <span class="text-[8px] font-black bg-emerald-200 text-emerald-900 px-1.5 py-0.5 rounded-lg uppercase">♻️</span>
        )}
      </div>
      <p class="text-[10px] text-slate-400 uppercase font-black tracking-[0.1em] truncate">
        {shape || 'Standard'}
      </p>
    </div>

    <div class="flex flex-col items-end min-w-[60px]">
        <div class="flex items-baseline gap-1">
            <span class={`text-2xl font-black leading-none ${isCritical ? 'text-red-600' : isLow ? 'text-amber-600' : 'text-slate-900'}`}>
                {currentCount}
            </span>
            <span class="text-[10px] font-bold text-slate-400">stk</span>
        </div>
        {isCritical ? (
            <span class="text-[8px] font-black text-red-600 uppercase mt-1 tracking-widest animate-pulse">Tomt</span>
        ) : isLow && (
            <span class="text-[8px] font-black text-amber-600 uppercase mt-1 tracking-widest">Lavt</span>
        )}
    </div>
  </div>

  <form method="POST" class="flex gap-2">
    <input type="hidden" name="action" value="adjust_stock" />
    <input type="hidden" name="stockId" value={id} />
    <input type="hidden" name="stockType" value={type} />
    
    <div class="relative flex-1">
        <input 
            type="number" 
            name="adjustment" 
            placeholder="Antall kjøpt..." 
            class="w-full text-xs font-black bg-white/50 border-2 border-slate-100 rounded-xl px-4 py-3 outline-none focus:border-indigo-400 focus:bg-white transition-all placeholder:text-slate-300"
        />
    </div>
    
    <button 
      type="submit" 
      class="bg-slate-900 text-white px-5 rounded-xl hover:bg-indigo-600 transition-all active:scale-90 flex items-center justify-center shadow-lg shadow-slate-200"
      title="Legg til i beholdning"
    >
        <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="3" stroke-linecap="round" stroke-linejoin="round">
            <path d="M5 12h14"></path>
            <path d="M12 5v14"></path>
        </svg>
    </button>
  </form>
</div>