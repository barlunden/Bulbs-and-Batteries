---
import "../styles/global.css"
import Nav from "../components/Nav.astro";

const { title } = Astro.props;

// Hent data frÃ¥ middleware (vÃ¥r sentrale vaktpost)
const user = Astro.locals.user;
const userEmail = user?.email;
const householdId = Astro.locals.householdId;

// Bestem kvar logo skal lenke basert pÃ¥ om brukar er innlogga
const logoLink = user ? "/dashboard" : "/";
---
<!doctype html>
<html lang="no">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <link rel="icon" type="image/svg+xml" href="/favicon.png" />
    <meta name="generator" content={Astro.generator} />
    <title>{title} | Fullt Lager</title>
  </head>
  <body class="bg-slate-50 font-sans antialiased text-slate-900">
    
    <header class="max-w-md mx-auto px-6 py-8 flex justify-between items-start relative">
      <!-- Dekorativ lyseffekt i bakgrunnen -->
      <div class="absolute inset-0 bg-gradient-to-br from-yellow-400/10 via-amber-300/5 to-transparent rounded-[3rem] blur-2xl -z-10 animate-pulse" style="animation-duration: 3s;"></div>
      
      <a href={logoLink} class="flex items-center gap-3 hover:opacity-80 transition-opacity">
        <!-- Lysende logo med glow-effekt -->
        <div class="relative group">
          <div class="absolute inset-0 bg-gradient-to-br from-amber-400 to-yellow-500 rounded-2xl blur-xl opacity-60 group-hover:opacity-100 transition-opacity"></div>
          <div class="relative w-12 h-12 bg-gradient-to-br from-amber-400 to-yellow-500 rounded-2xl flex items-center justify-center text-white font-black text-xl shadow-2xl shadow-yellow-500/50 ring-4 ring-white transform hover:scale-110 transition-transform">
            ðŸ’¡
          </div>
        </div>
        
        <div class="flex flex-col">
          <span class="font-black uppercase tracking-tighter text-base leading-none bg-gradient-to-r from-amber-600 to-yellow-600 bg-clip-text text-transparent">
            Fullt Lager
          </span>
          <span class="text-[9px] font-bold text-slate-400 uppercase tracking-[0.15em] mt-1">âœ¨ Glem det du mÃ¥ huske</span>
        </div>
      </a>

      {userEmail && (
        <div class="flex flex-col items-end gap-2">
          <div class="flex flex-col items-end leading-none">
            <span class="text-[8px] font-black uppercase text-slate-400 tracking-widest mb-1">Innlogget</span>
            <span class="text-[10px] font-bold bg-white px-3 py-1.5 rounded-full border border-yellow-200 shadow-sm text-yellow-700 ring-2 ring-yellow-100/50">
              {userEmail.split('@')[0]}
            </span>
          </div>
          
          <form action="/api/auth/signout" method="POST">
            <button type="submit" class="group flex items-center gap-1 text-[9px] font-black text-slate-400 uppercase tracking-widest hover:text-red-500 transition-colors">
              <svg xmlns="http://www.w3.org/2000/svg" width="10" height="10" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="3" stroke-linecap="round" stroke-linejoin="round"><path d="M9 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h4"/><polyline points="16 17 21 12 16 7"/><line x1="21" y1="12" x2="9" y2="12"/></svg>
              Logg ut
            </button>
          </form>
        </div>
      )}
    </header>

    <main>
      <slot />
    </main>

    <Nav />

    <footer class="py-8 text-center border-t border-slate-200 mt-16 bg-white">
      <div class="mb-3">
        <a href="/personvern" class="text-xs text-slate-600 hover:text-indigo-600 font-bold transition-colors">
          Personvern
        </a>
      </div>
      <p class="text-xs text-slate-500">
        Appen er utviklet av <a href="https://cominoweb.no" target="_blank" rel="noopener noreferrer" class="font-bold text-indigo-600 hover:text-indigo-500 transition-colors">Comino Web AS</a> Â© {new Date().getFullYear()}
      </p>
    </footer>

  </body>
</html>