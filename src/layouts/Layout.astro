---
import "../styles/global.css"
import Nav from "../components/Nav.astro";
import ToastProvider from "../components/ToastProvider";

const { title } = Astro.props;

// Hent data fra middleware
const user = Astro.locals.user;
const userEmail = user?.email;

// Bestem hvor logo skal lenke
const logoLink = user ? "/dashboard" : "/";
---
<!doctype html>
<html lang="no">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <link rel="icon" type="image/svg+xml" href="/favicon.png" />
    <meta name="generator" content={Astro.generator} />
    <title>{title} | Fullt Lager</title>
  </head>
  <body class="bg-slate-50 font-sans antialiased text-slate-900">
    
    <ToastProvider client:load />
    
    <header class="max-w-md mx-auto px-6 py-10 flex justify-between items-start relative">
      <div class="absolute inset-x-0 top-0 h-40 bg-gradient-to-b from-amber-100/20 to-transparent blur-3xl -z-10"></div>
      
      <a href={logoLink} class="flex items-center gap-3 hover:opacity-90 transition-all active:scale-95">
        <div class="relative group">
          <div class="absolute inset-0 bg-amber-400 rounded-2xl blur-xl opacity-20 group-hover:opacity-40 transition-opacity"></div>
          <div class="relative w-12 h-12 bg-gradient-to-br from-amber-400 to-yellow-500 rounded-2xl flex items-center justify-center text-white font-black text-xl shadow-lg shadow-yellow-500/20 ring-4 ring-white">
            ðŸ’¡
          </div>
        </div>
        
        <div class="flex flex-col">
          <span class="font-black uppercase tracking-tighter text-lg leading-none bg-gradient-to-r from-slate-900 to-slate-700 bg-clip-text text-transparent">
            Fullt Lager
          </span>
          <span class="text-[9px] font-black text-slate-400 uppercase tracking-widest mt-1.5 flex items-center gap-1">
            <span class="text-amber-500">âœ¨</span> Din digitale vaktmester
          </span>
        </div>
      </a>

      {userEmail && (
        <div class="flex flex-col items-end gap-3">
          <div class="flex flex-col items-end leading-none">
            <span class="text-[8px] font-black uppercase text-slate-300 tracking-[0.2em] mb-1.5">Bruker</span>
            <div class="bg-white px-3 py-1.5 rounded-xl border border-slate-100 shadow-sm text-[10px] font-black text-slate-600">
              {userEmail.split('@')[0]}
            </div>
          </div>
          
          <form action="/api/auth/signout" method="POST">
            <button type="submit" class="flex items-center gap-1 text-[9px] font-black text-slate-400 uppercase tracking-widest hover:text-red-500 transition-colors">
              <svg xmlns="http://www.w3.org/2000/svg" width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="3" stroke-linecap="round" stroke-linejoin="round"><path d="M9 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h4"/><polyline points="16 17 21 12 16 7"/><line x1="21" y1="12" x2="9" y2="12"/></svg>
              Logg ut
            </button>
          </form>
        </div>
      )}
    </header>

    <main class="relative z-10">
      <slot />
    </main>

    <Nav />

    <footer class="py-6 pb-32 text-center border-t border-slate-100 mt-20 bg-white/50">
  <div class="max-w-md mx-auto px-6">
    <div class="mb-4">
      <a href="/personvern" class="text-[10px] font-black uppercase tracking-widest text-slate-400 hover:text-indigo-600 transition-colors">
        Personvern & vilkÃ¥r
      </a>
    </div>
    
    <p class="text-[10px] text-slate-400 font-medium leading-relaxed">
      Fullt Lager er utviklet og driftes av<br/>
      <a href="https://cominoweb.no" target="_blank" rel="noopener" class="font-black text-slate-600 hover:text-indigo-600 transition-colors uppercase tracking-tighter text-xs">
        Comino Web AS
      </a>
    </p>
    
    <p class="text-[9px] text-slate-300 mt-4 uppercase tracking-[0.2em]">
      Â© {new Date().getFullYear()} â€” Stabilt og trygt levert
    </p>
  </div>
</footer>

  </body>
</html>