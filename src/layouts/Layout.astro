---
import "../styles/global.css"
import Nav from "../components/Nav.astro";

const { title } = Astro.props;

// Hent data frå middleware (vår sentrale vaktpost)
const user = Astro.locals.user;
const userEmail = user?.email;
const householdId = Astro.locals.householdId;
---
<!doctype html>
<html lang="no">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <link rel="icon" type="image/svg+xml" href="/favicon.svg" />
    <meta name="generator" content={Astro.generator} />
    <title>{title} | Bulbs & Batteries</title>
  </head>
  <body class="bg-slate-50 pb-32 font-sans antialiased text-slate-900">
    
    <header class="max-w-md mx-auto px-6 py-8 flex justify-between items-start">
      <div class="flex items-center gap-3">
        <div class="w-12 h-12 bg-indigo-600 rounded-2xl flex items-center justify-center text-white font-black italic shadow-xl shadow-indigo-100 ring-4 ring-white">
          B&B
        </div>
        <div class="flex flex-col">
          <span class="font-black uppercase tracking-tighter text-base leading-none">Bulbs & Batteries</span>
          <span class="text-[9px] font-bold text-slate-400 uppercase tracking-[0.15em] mt-1">Vedlikehaldssystem</span>
        </div>
      </div>

      {userEmail && (
        <div class="flex flex-col items-end gap-2">
          <div class="flex flex-col items-end leading-none">
            <span class="text-[8px] font-black uppercase text-slate-400 tracking-widest mb-1">Innlogga</span>
            <span class="text-[10px] font-bold bg-white px-3 py-1.5 rounded-full border border-slate-100 shadow-sm text-indigo-600">
              {userEmail.split('@')[0]}
            </span>
          </div>
          
          <form action="/api/auth/signout" method="POST">
            <button type="submit" class="group flex items-center gap-1 text-[9px] font-black text-slate-400 uppercase tracking-widest hover:text-red-500 transition-colors">
              <svg xmlns="http://www.w3.org/2000/svg" width="10" height="10" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="3" stroke-linecap="round" stroke-linejoin="round"><path d="M9 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h4"/><polyline points="16 17 21 12 16 7"/><line x1="21" y1="12" x2="9" y2="12"/></svg>
              Logg ut
            </button>
          </form>
        </div>
      )}
    </header>

    <main>
      <slot />
    </main>

    <Nav />

  </body>
</html>